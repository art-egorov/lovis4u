
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.3.9">
    
    
      
        <title>lovis4u.DataProcessing - LoVis4u</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1dff34a1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/material.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="yellow">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lovis4u.DataProcessing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LoVis4u" class="md-header__button md-logo" aria-label="LoVis4u" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="323.381359533894283" height="260.015054079451147" viewBox="0 0 323.381359533894283 260.015054079451147">
  <path d="M144.878146163539895,243.032236707560514c4.832221561207007,2.961180059852268,10.875146510551531,3.018939802777822,15.763031394350946.150571987071999,33.034193527262687-19.385525597268497,156.917684580716013-98.016440783813778,132.082821955653344-173.601617472293583-.025501623510536-.106058309954278-.060039763182431-.194538815170745-.094369234973783-.300674544888352-8.79578360430969-28.900611229507376-35.423053316744699-50.028509525108348-67.075249516115946-50.306097609291101-17.841350526741735-.156467699138375-34.197443509045115,6.332628995307459-46.746261956687704,17.176948538374745l-.008905268045055.008750428533858c-.008904795981834.008696600176336-.026584083970192.017370081007357-.035489352015247.026120509531211-.976722300330039.741105358874847-16.516037346986195,12.652859134849678-24.613064654506161,25.767630913555877-7.147998269328127-12.63106509517911-19.53543082402939-23.208935899741846-23.17837603114458-26.186759317060023-12.415806369687743-11.363104912140443-28.887203246029458-17.875510298740664-46.984292231332802-18.034220810617626-31.661077875986848-.27766597601476-58.648629772500499,20.688708632774251-67.949935153508704,49.430609350404666-.036239486124032.105516843693295-.075761853981021-.415174548465075-.103119663504913-.309579812932498-26.149908104082897,75.140391864422782,96.276637637532986,156.160278388198094,128.943209711830605,176.178317839610827Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 19px;"/>
  <polyline points="139.332575650858416 152.984145081090901 127.889487065721369 139.836698281043027 282.774539239640035 12.803855517929151 312.624243250169457 9.930813011666942 305.66071640991504 39.098749118018532 150.775664235996373 166.131591881136046 139.332575650858416 152.984145081090901" style="fill: #fff; stroke-width: 0px;"/>
  <polyline points="29.848886155835316 243.047036774129083 18.40579757069554 229.899589974081209 74.502859685117073 183.357024518563776 85.775012136684381 194.417145681524744 97.389036855392078 209.651918118654066 41.291974740971455 256.194483574174228 29.848886155835316 243.047036774129083" style="fill: #fff; stroke-width: 0px;"/>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LoVis4u
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              lovis4u.DataProcessing
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="yellow"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/art-egorov/lovis4u.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../ExampleDrivenGuide/cmd_guide/" class="md-tabs__link">
      Example-driven guide
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Parameters/cmd_parameters/" class="md-tabs__link">
        Parameters
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../usage_examples/" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../VersionLog/versions/" class="md-tabs__link">
      Version log
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LoVis4u" class="md-nav__button md-logo" aria-label="LoVis4u" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="323.381359533894283" height="260.015054079451147" viewBox="0 0 323.381359533894283 260.015054079451147">
  <path d="M144.878146163539895,243.032236707560514c4.832221561207007,2.961180059852268,10.875146510551531,3.018939802777822,15.763031394350946.150571987071999,33.034193527262687-19.385525597268497,156.917684580716013-98.016440783813778,132.082821955653344-173.601617472293583-.025501623510536-.106058309954278-.060039763182431-.194538815170745-.094369234973783-.300674544888352-8.79578360430969-28.900611229507376-35.423053316744699-50.028509525108348-67.075249516115946-50.306097609291101-17.841350526741735-.156467699138375-34.197443509045115,6.332628995307459-46.746261956687704,17.176948538374745l-.008905268045055.008750428533858c-.008904795981834.008696600176336-.026584083970192.017370081007357-.035489352015247.026120509531211-.976722300330039.741105358874847-16.516037346986195,12.652859134849678-24.613064654506161,25.767630913555877-7.147998269328127-12.63106509517911-19.53543082402939-23.208935899741846-23.17837603114458-26.186759317060023-12.415806369687743-11.363104912140443-28.887203246029458-17.875510298740664-46.984292231332802-18.034220810617626-31.661077875986848-.27766597601476-58.648629772500499,20.688708632774251-67.949935153508704,49.430609350404666-.036239486124032.105516843693295-.075761853981021-.415174548465075-.103119663504913-.309579812932498-26.149908104082897,75.140391864422782,96.276637637532986,156.160278388198094,128.943209711830605,176.178317839610827Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 19px;"/>
  <polyline points="139.332575650858416 152.984145081090901 127.889487065721369 139.836698281043027 282.774539239640035 12.803855517929151 312.624243250169457 9.930813011666942 305.66071640991504 39.098749118018532 150.775664235996373 166.131591881136046 139.332575650858416 152.984145081090901" style="fill: #fff; stroke-width: 0px;"/>
  <polyline points="29.848886155835316 243.047036774129083 18.40579757069554 229.899589974081209 74.502859685117073 183.357024518563776 85.775012136684381 194.417145681524744 97.389036855392078 209.651918118654066 41.291974740971455 256.194483574174228 29.848886155835316 243.047036774129083" style="fill: #fff; stroke-width: 0px;"/>
</svg>

    </a>
    LoVis4u
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/art-egorov/lovis4u.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ExampleDrivenGuide/cmd_guide/" class="md-nav__link">
        Example-driven guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Parameters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Parameters" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Parameters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Parameters/cmd_parameters/" class="md-nav__link">
        Command-line parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Parameters/config_parameters/" class="md-nav__link">
        Configuration file parameters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usage_examples/" class="md-nav__link">
        Usage examples
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          lovis4u.DataProcessing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        lovis4u.DataProcessing
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing" class="md-nav__link">
    lovis4u.DataProcessing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Feature" class="md-nav__link">
    Feature
  </a>
  
    <nav class="md-nav" aria-label="Feature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Feature.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci" class="md-nav__link">
    Loci
  </a>
  
    <nav class="md-nav" aria-label="Loci">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.__load_annotation_file" class="md-nav__link">
    __load_annotation_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.__update_feature_annotation" class="md-nav__link">
    __update_feature_annotation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.__update_loci_annotation" class="md-nav__link">
    __update_loci_annotation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.cluster_sequences" class="md-nav__link">
    cluster_sequences()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.define_features_groups" class="md-nav__link">
    define_features_groups()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.define_labels_to_be_shown" class="md-nav__link">
    define_labels_to_be_shown()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.find_variable_feature_groups" class="md-nav__link">
    find_variable_feature_groups()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.get_loci_lengths_and_n_of_regions" class="md-nav__link">
    get_loci_lengths_and_n_of_regions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.load_features_annotation_file" class="md-nav__link">
    load_features_annotation_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.load_loci_annotation_file" class="md-nav__link">
    load_loci_annotation_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.load_loci_from_extended_gff" class="md-nav__link">
    load_loci_from_extended_gff()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.load_loci_from_gb" class="md-nav__link">
    load_loci_from_gb()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.mmseqs_cluster" class="md-nav__link">
    mmseqs_cluster()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.reorient_loci" class="md-nav__link">
    reorient_loci()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.save_features_annotation_table" class="md-nav__link">
    save_features_annotation_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.save_loci_annotation_table" class="md-nav__link">
    save_loci_annotation_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.set_category_colors" class="md-nav__link">
    set_category_colors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Loci.set_feature_colors_based_on_groups" class="md-nav__link">
    set_feature_colors_based_on_groups()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Locus" class="md-nav__link">
    Locus
  </a>
  
    <nav class="md-nav" aria-label="Locus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lovis4u.DataProcessing.Locus.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../package_manager/" class="md-nav__link">
        lovis4u.Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../package_drawing/" class="md-nav__link">
        lovis4u.Drawing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../package_methods/" class="md-nav__link">
        lovis4u.Methods
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VersionLog/versions/" class="md-nav__link">
        Version log
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>lovis4u.DataProcessing</h1>

<div class="doc doc-object doc-module">


<a id="lovis4u.DataProcessing"></a>
  <div class="doc doc-contents first">
  
      <p>This module provides managing classes and methods for the tool.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="lovis4u.DataProcessing.Feature" class="doc doc-heading">
        <code>Feature</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A Feature object represents a locus' feature (currently only CDS) and its properties.</p>

  <p><b>Attributes:</b></p>
  <ul>
      <li class="field-body">
        <b>feature_id</b>
            (<code>str</code>)
        – <p>Feature identifier.</p>
      </li>
      <li class="field-body">
        <b>feature_type</b>
            (<code>str</code>)
        – <p>Type of element (e.g. CDS or tRNA). Currently only CDS are supported.</p>
      </li>
      <li class="field-body">
        <b>start</b>
            (<code>int</code>)
        – <p>1-based start genomic coordinate.</p>
      </li>
      <li class="field-body">
        <b>end</b>
            (<code>int</code>)
        – <p>1-based end genomic coordinates</p>
      </li>
      <li class="field-body">
        <b>strand</b>
            (<code>int</code>)
        – <p>Genomic strand (1: plus strand, -1: minus strand).</p>
      </li>
      <li class="field-body">
        <b>name</b>
            (<code>str</code>)
        – <p>Name of the feature which will be used as a label.</p>
      </li>
      <li class="field-body">
        <b>sequence</b>
            (<code><span title="Bio.Seq.Seq">Seq</span></code>)
        – <p>Feature's sequence.</p>
      </li>
      <li class="field-body">
        <b>record</b>
            (<code><span title="Bio.SeqRecord.SeqRecord">SeqRecord</span></code>)
        – <p>SeqRecord object of corresponding feature sequence.</p>
      </li>
      <li class="field-body">
        <b>group</b>
            (<code>str</code>)
        – <p>Feature group that defines feature's color and meant to represent a set of homologous features.
Can be set with Loci.mmseqs_cluster() method that uses mmseqs clustering to define CDS feature groups.</p>
      </li>
      <li class="field-body">
        <b>group_type</b>
            (<code>str</code>)
        – <p>Type of feature group that allow to visualise different set of feature groups differently
(e.g. plot labels only for features which group_type is "variable" or "labeled").</p>
      </li>
      <li class="field-body">
        <b>category</b>
            (<code>str</code>)
        – <p>Feature category which initially is built to handle phrogs category annotation.
In visualisation it defines the "category" color annotation under features.
Supposed to represent clusters on locus or any second layer of feature properties.</p>
      </li>
      <li class="field-body">
        <b>vis_prms</b>
            (<code>dict</code>)
        – <p>Visualisation parameters that holds colors, label and other info for Drawing methods.</p>
      </li>
      <li class="field-body">
        <b>prms</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
  </ul>


        <details class="quote">
          <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Feature</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Feature object represents a locus&#39; feature (currently only CDS) and its properties.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        feature_id (str): Feature identifier.</span>
<span class="sd">        feature_type (str): Type of element (e.g. CDS or tRNA). Currently only CDS are supported.</span>
<span class="sd">        start (int): 1-based start genomic coordinate.</span>
<span class="sd">        end (int): 1-based end genomic coordinates</span>
<span class="sd">        strand (int): Genomic strand (1: plus strand, -1: minus strand).</span>
<span class="sd">        name (str): Name of the feature which will be used as a label.</span>
<span class="sd">        sequence (Bio.Seq.Seq): Feature&#39;s sequence.</span>
<span class="sd">        record (Bio.SeqRecord.SeqRecord): SeqRecord object of corresponding feature sequence.</span>
<span class="sd">        group (str): Feature group that defines feature&#39;s color and meant to represent a set of homologous features.</span>
<span class="sd">            Can be set with Loci.mmseqs_cluster() method that uses mmseqs clustering to define CDS feature groups.</span>
<span class="sd">        group_type (str): Type of feature group that allow to visualise different set of feature groups differently</span>
<span class="sd">            (e.g. plot labels only for features which group_type is &quot;variable&quot; or &quot;labeled&quot;).</span>
<span class="sd">        category (str): Feature category which initially is built to handle phrogs category annotation.</span>
<span class="sd">            In visualisation it defines the &quot;category&quot; color annotation under features.</span>
<span class="sd">            Supposed to represent clusters on locus or any second layer of feature properties.</span>
<span class="sd">        vis_prms (dict): Visualisation parameters that holds colors, label and other info for Drawing methods.</span>
<span class="sd">        prms (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">strand</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">sequence</span><span class="p">:</span> <span class="n">Bio</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">Seq</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vis_prms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">parameters</span><span class="p">:</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Feature object.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            feature_id (str): Feature identifier.</span>
<span class="sd">            feature_type (str): Type of element (e.g. CDS or tRNA). Currently only CDS are supported.</span>
<span class="sd">            start (int): 1-based start genomic coordinate.</span>
<span class="sd">            end (int): 1-based end genomic coordinates</span>
<span class="sd">            strand (int): Genomic strand (1: plus strand, -1: minus strand).</span>
<span class="sd">            name (str): Name of the feature which will be used as a label.</span>
<span class="sd">            sequence (Bio.Seq.Seq): Feature&#39;s sequence.</span>
<span class="sd">            group (str): Feature group that defines feature&#39;s color and meant to represent a set of homologous features.</span>
<span class="sd">                Can be set with Loci.mmseqs_cluster() method that uses mmseqs clustering to define CDS feature groups.</span>
<span class="sd">            group_type (str): Type of feature group that allow to visualise different set of feature groups differently</span>
<span class="sd">                (e.g. plot labels only for features which group_type is &quot;variable&quot; or &quot;labeled&quot;).</span>
<span class="sd">            category (str): Feature category which initially is built to handle phrogs category annotation.</span>
<span class="sd">                In visualisation it defines the &quot;category&quot; color annotation under features.</span>
<span class="sd">                Supposed to represent clusters on locus or any second layer of feature properties.</span>
<span class="sd">            vis_prms (dict): Visualisation parameters that holds colors, label and other info for Drawing methods.</span>
<span class="sd">            prms (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_type</span> <span class="o">=</span> <span class="n">feature_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strand</span> <span class="o">=</span> <span class="n">strand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">Bio</span><span class="o">.</span><span class="n">SeqRecord</span><span class="o">.</span><span class="n">SeqRecord</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>  <span class="c1"># maybe rename later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">group_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_prms</span> <span class="o">=</span> <span class="n">vis_prms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Feature.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">strand</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_type</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">vis_prms</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a Feature object.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>feature_id</b>
            (<code>str</code>)
        – <p>Feature identifier.</p>
      </li>
      <li class="field-body">
        <b>feature_type</b>
            (<code>str</code>)
        – <p>Type of element (e.g. CDS or tRNA). Currently only CDS are supported.</p>
      </li>
      <li class="field-body">
        <b>start</b>
            (<code>int</code>)
        – <p>1-based start genomic coordinate.</p>
      </li>
      <li class="field-body">
        <b>end</b>
            (<code>int</code>)
        – <p>1-based end genomic coordinates</p>
      </li>
      <li class="field-body">
        <b>strand</b>
            (<code>int</code>)
        – <p>Genomic strand (1: plus strand, -1: minus strand).</p>
      </li>
      <li class="field-body">
        <b>name</b>
            (<code>str</code>)
        – <p>Name of the feature which will be used as a label.</p>
      </li>
      <li class="field-body">
        <b>sequence</b>
            (<code><span title="Bio.Seq.Seq">Seq</span></code>)
        – <p>Feature's sequence.</p>
      </li>
      <li class="field-body">
        <b>group</b>
            (<code>str</code>)
        – <p>Feature group that defines feature's color and meant to represent a set of homologous features.
Can be set with Loci.mmseqs_cluster() method that uses mmseqs clustering to define CDS feature groups.</p>
      </li>
      <li class="field-body">
        <b>group_type</b>
            (<code>str</code>)
        – <p>Type of feature group that allow to visualise different set of feature groups differently
(e.g. plot labels only for features which group_type is "variable" or "labeled").</p>
      </li>
      <li class="field-body">
        <b>category</b>
            (<code>str</code>)
        – <p>Feature category which initially is built to handle phrogs category annotation.
In visualisation it defines the "category" color annotation under features.
Supposed to represent clusters on locus or any second layer of feature properties.</p>
      </li>
      <li class="field-body">
        <b>vis_prms</b>
            (<code>dict</code>)
        – <p>Visualisation parameters that holds colors, label and other info for Drawing methods.</p>
      </li>
      <li class="field-body">
        <b>prms</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">strand</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">sequence</span><span class="p">:</span> <span class="n">Bio</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">Seq</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vis_prms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
             <span class="n">parameters</span><span class="p">:</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Feature object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        feature_id (str): Feature identifier.</span>
<span class="sd">        feature_type (str): Type of element (e.g. CDS or tRNA). Currently only CDS are supported.</span>
<span class="sd">        start (int): 1-based start genomic coordinate.</span>
<span class="sd">        end (int): 1-based end genomic coordinates</span>
<span class="sd">        strand (int): Genomic strand (1: plus strand, -1: minus strand).</span>
<span class="sd">        name (str): Name of the feature which will be used as a label.</span>
<span class="sd">        sequence (Bio.Seq.Seq): Feature&#39;s sequence.</span>
<span class="sd">        group (str): Feature group that defines feature&#39;s color and meant to represent a set of homologous features.</span>
<span class="sd">            Can be set with Loci.mmseqs_cluster() method that uses mmseqs clustering to define CDS feature groups.</span>
<span class="sd">        group_type (str): Type of feature group that allow to visualise different set of feature groups differently</span>
<span class="sd">            (e.g. plot labels only for features which group_type is &quot;variable&quot; or &quot;labeled&quot;).</span>
<span class="sd">        category (str): Feature category which initially is built to handle phrogs category annotation.</span>
<span class="sd">            In visualisation it defines the &quot;category&quot; color annotation under features.</span>
<span class="sd">            Supposed to represent clusters on locus or any second layer of feature properties.</span>
<span class="sd">        vis_prms (dict): Visualisation parameters that holds colors, label and other info for Drawing methods.</span>
<span class="sd">        prms (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_type</span> <span class="o">=</span> <span class="n">feature_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strand</span> <span class="o">=</span> <span class="n">strand</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">Bio</span><span class="o">.</span><span class="n">SeqRecord</span><span class="o">.</span><span class="n">SeqRecord</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>  <span class="c1"># maybe rename later</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">group_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vis_prms</span> <span class="o">=</span> <span class="n">vis_prms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="lovis4u.DataProcessing.Loci" class="doc doc-heading">
        <code>Loci</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A Loci object holds information about all loci to be plotted and methods for data preparation.</p>

  <p><b>Attributes:</b></p>
  <ul>
      <li class="field-body">
        <b>loci</b>
            (<code>list</code>)
        – <p>List of Locus objects.</p>
      </li>
      <li class="field-body">
        <b>loci_annotation</b>
            (<code><span title="pandas.DataFrame">DataFrame</span></code>)
        – <p>Table with information about each locus that defines visualisation
(e.g. coordinates for visualisation, description, etc).</p>
      </li>
      <li class="field-body">
        <b>feature_annotation</b>
            (<code><span title="pandas.DataFrame">DataFrame</span></code>)
        – <p>Table with information about each feature that defines visualisation
(e.g. group, name, category, etc).</p>
      </li>
      <li class="field-body">
        <b>prms</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
  </ul>


        <details class="quote">
          <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Loci</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Loci object holds information about all loci to be plotted and methods for data preparation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        loci (list): List of Locus objects.</span>
<span class="sd">        loci_annotation (pd.DataFrame): Table with information about each locus that defines visualisation</span>
<span class="sd">            (e.g. coordinates for visualisation, description, etc).</span>
<span class="sd">        feature_annotation (pd.DataFrame): Table with information about each feature that defines visualisation</span>
<span class="sd">            (e.g. group, name, category, etc).</span>
<span class="sd">        prms (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Loci object.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            parameters (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;circular&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locus_id&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">,</span> <span class="s2">&quot;stroke_color&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;show_label&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">__load_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">index_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private method to load an annotation file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_path (str): File path for an annotation file to be loaded.</span>
<span class="sd">            annotation_columns (list): List of columns that should be considered.</span>
<span class="sd">            index_column (str): Column name to be considered as index.</span>

<span class="sd">        Returns:</span>
<span class="sd">              pd.DataFrame: Preprocessed annotation file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">found_allowed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">not_found_allowed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">annotation_table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">annotation_table</span> <span class="o">=</span> <span class="n">annotation_table</span><span class="p">[</span><span class="n">found_allowed_columns</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_column</span><span class="p">)</span>
        <span class="n">annotation_table</span><span class="p">[</span><span class="n">not_found_allowed_columns</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">annotation_table</span>

    <span class="k">def</span> <span class="nf">load_loci_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load loci annotation file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_path (str): File path for a loci annotation file to be loaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;circular&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">,</span> <span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">load_features_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load features annotation file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_path (str): File path for a features annotation file to be loaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locus_id&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">,</span> <span class="s2">&quot;stroke_color&quot;</span><span class="p">,</span> <span class="s2">&quot;show_label&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">,</span> <span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__update_loci_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private method for updating loci annotation.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            record_id (str): Sequence identifier.</span>
<span class="sd">            record_description (str): Sequence description.</span>
<span class="sd">            record_length (int): Sequence length.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">record_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

        <span class="n">default_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">record_length</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;1:</span><span class="si">{</span><span class="n">record_length</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                              <span class="n">description</span><span class="o">=</span><span class="n">record_description</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">default_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__update_feature_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">locus_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private method for updating feature annotation.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            feature_id (str): Feature identifier.</span>
<span class="sd">            locus_id (str): Sequence description.</span>
<span class="sd">            coordinates (str): Feature coordinates.</span>
<span class="sd">            category (str): Feature type.</span>
<span class="sd">            name (str): Feature name.</span>


<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;group_type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]</span> \
                <span class="ow">or</span> <span class="s2">&quot;all&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
            <span class="n">show_label</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">show_label</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stroke_color</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;set_feature_stroke_color_based_on_fill_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">stroke_color</span> <span class="o">=</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Methods</span><span class="o">.</span><span class="n">scale_lightness</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_stroke_color_relative_lightness&quot;</span><span class="p">])</span>
        <span class="n">default_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">locus_id</span><span class="o">=</span><span class="n">locus_id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="n">feature_type</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">group_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
                              <span class="n">stroke_color</span><span class="o">=</span><span class="n">stroke_color</span><span class="p">,</span>
                              <span class="n">show_label</span><span class="o">=</span><span class="n">show_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">default_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">load_loci_from_extended_gff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load loci from the folder with gff files. Each GFF file also should contain corresponding nucleotide</span>
<span class="sd">            sequence. Such files are produced for example by pharokka annotation tool.</span>

<span class="sd">        Note:</span>
<span class="sd">            All files with extension other than .gff (not case-sensitive) will be ignored.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            input_folder: folder name with gff files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_folder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gff_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.gff&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gff_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not contain .gff(.GFF) files.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gff_file</span> <span class="ow">in</span> <span class="n">gff_files</span><span class="p">:</span>
                <span class="n">gff_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">gff_file</span><span class="p">)</span>
                <span class="n">gff_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BCBio</span><span class="o">.</span><span class="n">GFF</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">gff_file_path</span><span class="p">,</span> <span class="n">limit_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">gff_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDS&quot;</span><span class="p">])))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gff_records</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gff file </span><span class="si">{</span><span class="n">gff_file</span><span class="si">}</span><span class="s2"> does not contain information for only&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot; 1 sequence.&quot;</span><span class="p">)</span>
                <span class="n">gff_record</span> <span class="o">=</span> <span class="n">gff_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">record_locus_sequence</span> <span class="o">=</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">seq</span>
                <span class="k">except</span> <span class="n">Bio</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">UndefinedSequenceError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gff file doesn&#39;t contain corresponding sequences.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_description_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">:</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_description_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record_description</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record_description</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__update_loci_annotation</span><span class="p">(</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record_description</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">))</span>
                <span class="n">locus_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;strand&quot;</span><span class="p">],</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>
                               <span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                <span class="n">record_locus</span> <span class="o">=</span> <span class="n">Locus</span><span class="p">(</span><span class="n">seq_id</span><span class="o">=</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                     <span class="n">description</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                                     <span class="n">circular</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;circular&quot;</span><span class="p">],</span>
                                     <span class="n">length</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[],</span>
                                     <span class="n">order</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
                <span class="n">features_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gff file </span><span class="si">{</span><span class="n">gff_file</span><span class="si">}</span><span class="s2"> contains duplicated feature ids while&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot; only unique are allowed.&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gff_feature</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">id</span>
                    <span class="n">transl_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;default_transl_table&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;transl_table&quot;</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">transl_table</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;transl_table&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_name_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_name_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_function_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                        <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_function_source&quot;</span><span class="p">]])</span>
                    <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__update_feature_annotation</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span>
                                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;CDS&quot;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                            <span class="n">feature_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
                            <span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">feature_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">],</span>
                                              <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                              <span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span>
                                              <span class="n">name</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                              <span class="n">sequence</span><span class="o">=</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">transl_table</span><span class="p">,</span>
                                                                             <span class="n">cds</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">group</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">],</span>
                                              <span class="n">group_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group_type&quot;</span><span class="p">],</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                                              <span class="n">vis_prms</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                            <span class="n">stroke_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;stroke_color&quot;</span><span class="p">],</span>
                                                            <span class="n">show_label</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]),</span>
                                              <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">)</span>
                            <span class="n">record_locus</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_locus</span><span class="p">)</span>
            <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> locus was loaded from extended gff files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> loci were loaded from extended gff files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to load loci from gff folder.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">load_loci_from_gb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load loci from the folder with genbank files.</span>

<span class="sd">        Note:</span>
<span class="sd">            All files with extension other than .gb (not case-sensitive) will be ignored.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            input_folder: folder name with gb files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_folder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gb_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.gb&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gb_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not contain .gb(.GB) files.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gb_file</span> <span class="ow">in</span> <span class="n">gb_files</span><span class="p">:</span>
                <span class="n">gb_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">gb_file</span><span class="p">)</span>
                <span class="n">gb_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Bio</span><span class="o">.</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">gb_file_path</span><span class="p">,</span> <span class="s2">&quot;genbank&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gb_records</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gb file </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2"> does not contain information for only&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot; 1 sequence.&quot;</span><span class="p">)</span>
                <span class="n">gb_record</span> <span class="o">=</span> <span class="n">gb_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">record_locus_sequence</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">seq</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">description</span>
                <span class="k">elif</span> <span class="s2">&quot;annotations:&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]:</span>
                    <span class="n">feature_description_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="n">feature_description_key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__update_loci_annotation</span><span class="p">(</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record_description</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">))</span>
                <span class="n">locus_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;strand&quot;</span><span class="p">],</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>
                               <span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                <span class="n">record_locus</span> <span class="o">=</span> <span class="n">Locus</span><span class="p">(</span><span class="n">seq_id</span><span class="o">=</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                     <span class="n">description</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                                     <span class="n">circular</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;circular&quot;</span><span class="p">],</span>
                                     <span class="n">length</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[],</span>
                                     <span class="n">order</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>

                <span class="n">gb_CDSs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;CDS&quot;</span><span class="p">]</span>
                <span class="n">first_CDS_record</span> <span class="o">=</span> <span class="n">gb_CDSs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">id_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_CDS_record</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">alternative_id_source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_alternative_source&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">alternative_id_source</span> <span class="ow">in</span> <span class="n">first_CDS_record</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                            <span class="n">id_source</span> <span class="o">=</span> <span class="n">alternative_id_source</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❗ Warning: there is no &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt; attribute &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;for CDS records in </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2">. Alternative &lt;</span><span class="si">{</span><span class="n">id_source</span><span class="si">}</span><span class="s2">&gt; was used instead.&quot;</span><span class="p">,</span>
                                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">id_source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt; &quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot;attribute for CDS record found in </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2">. We tried to&quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot; find any from the alternative list: &quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_alternative_source&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot;, but they also weren&#39;t found.&quot;</span><span class="p">)</span>  <span class="c1"># add about cmd parameter</span>
                <span class="n">features_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">id_source</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gb_CDSs</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GB file </span><span class="si">{</span><span class="n">gb_record</span><span class="si">}</span><span class="s2"> contains duplicated feature ids while&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot; only unique are allowed.&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gb_feature</span> <span class="ow">in</span> <span class="n">gb_CDSs</span><span class="p">:</span>
                    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">id_source</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">transl_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;default_transl_table&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;transl_table&quot;</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">transl_table</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;transl_table&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_name_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_name_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_function_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                        <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_function_source&quot;</span><span class="p">]])</span>
                    <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__update_feature_annotation</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span>
                                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;CDS&quot;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                            <span class="n">feature_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
                            <span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">feature_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">],</span>
                                              <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                              <span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span>
                                              <span class="n">strand</span><span class="o">=</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                              <span class="n">sequence</span><span class="o">=</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">transl_table</span><span class="p">,</span>
                                                                            <span class="n">cds</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">group</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">],</span>
                                              <span class="n">group_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group_type&quot;</span><span class="p">],</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                                              <span class="n">vis_prms</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                            <span class="n">stroke_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;stroke_color&quot;</span><span class="p">],</span>
                                                            <span class="n">show_label</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]),</span>
                                              <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">)</span>

                            <span class="n">record_locus</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_locus</span><span class="p">)</span>
            <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> locus was loaded from genbank files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> loci were loaded from genbank files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to load loci from gb folder.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">save_loci_annotation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save loci annotation table to the output folder.</span>

<span class="sd">        Note:</span>
<span class="sd">            Output file name is loci_annotation_table.tsv</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;loci_annotation_table.tsv&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Loci annotation table was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to save loci annotation table.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">save_features_annotation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save feature annotation table to the output folder.</span>

<span class="sd">        Note:</span>
<span class="sd">            Output file name is features_annotation_table.tsv</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;features_annotation_table.tsv&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Feature annotation table was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to save feature annotation table.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">mmseqs_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cluster all proteins using mmseqs in order to define groups of homologues.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: parsed mmseqs table (pandas dataframe) with columns: cluster, protein_id; where cluster is</span>
<span class="sd">                defined by representative sequence id within a corresponding cluster.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Running mmseqs for protein clustering...&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">feature_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">record</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
            <span class="n">temp_input</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
            <span class="n">Bio</span><span class="o">.</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">feature_records</span><span class="p">,</span> <span class="n">temp_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
            <span class="n">mmseqs_output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;mmseqs&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">)</span>
            <span class="n">mmseqs_output_folder_db</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;DB&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">)</span>
            <span class="n">mmseqs_stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_stdout.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">mmseqs_stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_stderr.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;createdb&quot;</span><span class="p">,</span> <span class="n">temp_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">)],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span>
                           <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;clusterDB&quot;</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">),</span>
                            <span class="s2">&quot;--cluster-mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_cluster_mode&quot;</span><span class="p">]),</span>
                            <span class="s2">&quot;--cov-mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_cov_mode&quot;</span><span class="p">]),</span>
                            <span class="s2">&quot;--min-seq-id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_min_seq_id&quot;</span><span class="p">]),</span>
                            <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_c&quot;</span><span class="p">]),</span>
                            <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_s&quot;</span><span class="p">])],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;createtsv&quot;</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;clusterDB&quot;</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_clustering.tsv&quot;</span><span class="p">)],</span>
                           <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
            <span class="n">mmseqs_clustering_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_clustering.tsv&quot;</span><span class="p">),</span>
                                                      <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;protein_id&quot;</span><span class="p">])</span>
            <span class="n">mmseqs_clustering_results</span> <span class="o">=</span> <span class="n">mmseqs_clustering_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;protein_id&quot;</span><span class="p">)</span>

            <span class="n">num_of_unique_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mmseqs_clustering_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
            <span class="n">num_of_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mmseqs_clustering_results</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">num_of_unique_clusters</span><span class="si">}</span><span class="s2"> clusters for </span><span class="si">{</span><span class="n">num_of_proteins</span><span class="si">}</span><span class="s2"> proteins were found with mmseqs</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;💌 mmseqs clustering results were saved to &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mmseqs_clustering.tsv&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mmseqs_clustering_results</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to run mmseqs clustering.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">define_features_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cluster&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set features attribute &quot;group&quot; based on input dataframe.</span>

<span class="sd">        Note:</span>
<span class="sd">            By default is designed to use mmseqs_cluster() function results as input. If you already have precomputed</span>
<span class="sd">            feature groups you can set them with feature table.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            dataframe (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">                represent all loci CDS features.</span>
<span class="sd">            group_column_name (str): column name of the dataframe that represent corresponding group to each feature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_groups&quot;</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define protein features groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">define_labels_to_be_shown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set feature visaulisation attribute &quot;show_label&quot; based on feature groups.</span>

<span class="sd">        Note:</span>
<span class="sd">            controlled by feature_labels_to_ignore, feature_group_types_to_show_label, and</span>
<span class="sd">            feature_group_types_to_show_label_on_first_occurrence parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">added_first_occurrence_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_all_feature_labels&quot;</span><span class="p">]:</span>
                        <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_labels_to_ignore&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;any&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
                            <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
                            <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label_on_first_occurrence&quot;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_first_occurrence_labels</span><span class="p">:</span>
                                <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="n">added_first_occurrence_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable define feature labels to be shown.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">cluster_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define loci order and clusters with proteome similarity based hierarchical clustering.</span>
<span class="sd">            This function changes the order of loci that are plotted and also updates corresponding to each loci group</span>
<span class="sd">            attribute which defines homologues groups of proteomes.</span>

<span class="sd">        Note: It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues</span>
<span class="sd">            groups by other method you can also build pandas dataframe based on that with index corresponding to</span>
<span class="sd">            feature id and column &quot;cluster&quot; corresponding to the group.</span>

<span class="sd">        Arguments:</span>
<span class="sd">              dataframe (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">                represent all loci CDS features.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proteins_loci_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">)</span>
            <span class="n">loci_clusters_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">number_of_loci</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span>
            <span class="n">proteome_sizes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
                <span class="n">locus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
                <span class="n">loci_clusters</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
                <span class="n">loci_clusters_dict</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loci_clusters</span><span class="p">))</span>
                <span class="n">proteome_sizes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loci_clusters</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">l_cl</span> <span class="ow">in</span> <span class="n">loci_clusters</span><span class="p">:</span>
                    <span class="n">proteins_loci_dict</span><span class="p">[</span><span class="n">l_cl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locus_index</span><span class="p">)</span>

            <span class="n">loci_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">]</span>
            <span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">loci_clusters_dict</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]:</span>
                    <span class="n">js</span> <span class="o">=</span> <span class="n">proteins_loci_dict</span><span class="p">[</span><span class="n">cluster</span><span class="p">]</span>
                    <span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">js</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">locus_size</span> <span class="o">=</span> <span class="n">proteome_sizes</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
                <span class="n">norm_factors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">locus_size</span> <span class="o">+</span> <span class="n">proteome_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">locus_size</span> <span class="o">*</span> <span class="n">proteome_sizes</span><span class="p">),</span>
                                         <span class="n">index</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">norm_factors</span><span class="p">)</span>
                <span class="n">similarity_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">symmetric_distance_matrix</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">similarity_matrix</span>
            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">symmetric_distance_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span>
                <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">squareform</span><span class="p">(</span><span class="n">symmetric_distance_matrix</span><span class="p">),</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
            <span class="n">dendrogram</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">,</span> <span class="n">no_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">),</span>
                                 <span class="n">index</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">dendrogram</span><span class="p">[</span><span class="s2">&quot;leaves&quot;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;initial_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
                <span class="n">locus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">locus_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>

            <span class="n">reordered_similarity_matrix</span> <span class="o">=</span> <span class="n">similarity_matrix</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                                    <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;proteome_similarity_matrix.tsv&quot;</span><span class="p">)</span>
            <span class="n">reordered_similarity_matrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">num_of_loci_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">num_of_loci_groups</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🫧 Loci order and </span><span class="si">{</span><span class="n">num_of_loci_groups</span><span class="si">}</span><span class="s2"> cluster was defined with proteome similarity based &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;hierarchical clustering&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">num_of_loci_groups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🫧 Loci order and </span><span class="si">{</span><span class="n">num_of_loci_groups</span><span class="si">}</span><span class="s2"> clusters were defined with proteome similarity based &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;hierarchical clustering&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Proteome similarity matrix of loci was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to cluster loci sequences.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">find_variable_feature_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mmseqs_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define feature group type attributes (variable or shell/core) based on their conservation in corresponding</span>
<span class="sd">            loci group feature.</span>

<span class="sd">        Note: It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues</span>
<span class="sd">            groups by other method you can also build pandas dataframe based on that with index corresponding to</span>
<span class="sd">            feature id and column &quot;cluster&quot; corresponding to the group.</span>

<span class="sd">        Arguments:</span>
<span class="sd">              mmseqs_results (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">                represent all loci CDS features.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loci_clusters_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="n">loci_clusters_cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;CDS_is_variable_cutoff&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">loci_clusters_sizes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">loci_clusters_cutoffs</span><span class="p">[</span><span class="n">loci_clusters_cutoffs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">cluster_types</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">mmseqs_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
                <span class="n">cluster_proteins</span> <span class="o">=</span> <span class="n">mmseqs_results</span><span class="p">[</span><span class="n">mmseqs_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">cluster_loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">if</span>
                                <span class="nb">any</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span> <span class="ow">in</span> <span class="n">cluster_proteins</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">)]</span>
                <span class="n">cluster_loci_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="n">cluster_loci</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cluster_locus_group</span> <span class="ow">in</span> <span class="n">cluster_loci_groups</span><span class="p">:</span>
                    <span class="n">current_group_cluster_loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="n">cluster_loci</span> <span class="k">if</span>
                                                  <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="n">cluster_locus_group</span><span class="p">]</span>
                    <span class="n">current_group_cluster_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_group_cluster_loci</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">loci_clusters_sizes</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> \
                            <span class="n">current_group_cluster_size</span> <span class="o">&lt;=</span> <span class="n">loci_clusters_cutoffs</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">]:</span>
                        <span class="n">cluster_types</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">][</span><span class="n">cluster</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;variable&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cluster_types</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">][</span><span class="n">cluster</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;shell/core&quot;</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="n">locus_group</span> <span class="o">=</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_groups&quot;</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">cluster_types</span><span class="p">[</span><span class="n">locus_group</span><span class="p">][</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define variable feature groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">set_feature_colors_based_on_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define features fill color based on corresponding feature group and group types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">feature_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                    <span class="s2">&quot;all&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]:</span>
                <span class="n">feature_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span>
                                      <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]])</span>
            <span class="n">number_of_unique_feature_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_groups</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_palette_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;seaborn&quot;</span><span class="p">:</span>
                <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_seaborn_palette&quot;</span><span class="p">],</span>
                                                   <span class="n">number_of_unique_feature_groups</span><span class="p">,</span>
                                                   <span class="n">desat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_seaborn_desat&quot;</span><span class="p">])</span>
                <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">colors_rgb</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_palette_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;distinctipy&quot;</span><span class="p">:</span>
                <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">distinctipy</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">number_of_unique_feature_groups</span><span class="p">,</span>
                                                    <span class="n">exclude_colors</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                                                    <span class="n">pastel_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_colors_pastel_factor&quot;</span><span class="p">])</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">colors_rgb</span><span class="p">))</span>
            <span class="n">colors_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_groups</span><span class="p">),</span> <span class="n">colors</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">feature_groups</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_colors&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors_dict</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to set feature colors based on groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">set_category_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_table</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define colors for each category.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            use_table (bool): Bool value whether table with predefined colors should be used or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">colors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">use_table</span><span class="p">:</span>
                <span class="n">colors_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_colors&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

            <span class="n">feature_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">category</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span>
                                           <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">category</span><span class="p">]))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_categories</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❗ Warning: there are no feature categories to set colors&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="n">colors_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">cat</span><span class="p">:</span> <span class="n">col</span> <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">feature_categories</span><span class="p">}</span>

            <span class="n">feature_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">feature_categories</span> <span class="k">if</span> <span class="n">ff</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colors_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="n">number_of_unique_feature_functions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_categories</span><span class="p">)</span>
            <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_color_seaborn_palette&quot;</span><span class="p">],</span>
                                               <span class="n">number_of_unique_feature_functions</span><span class="p">,</span>
                                               <span class="n">desat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_color_seaborn_desat&quot;</span><span class="p">])</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">colors_rgb</span><span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">colors_rgb</span><span class="p">))</span>
            <span class="n">colors_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_categories</span><span class="p">),</span> <span class="n">colors</span><span class="p">)})</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="n">locus</span><span class="o">.</span><span class="n">category_colors</span> <span class="o">=</span> <span class="n">colors_dict</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to set category colors.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">reorient_loci</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Auto re-orient loci (reset strands) of loci if they are not matched.</span>

<span class="sd">        Note:</span>
<span class="sd">            Function tries to maximise co-orientation of homologous features.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loci_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
            <span class="n">count_of_changed_strands</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">loci_group</span> <span class="ow">in</span> <span class="n">loci_groups</span><span class="p">:</span>
                <span class="n">loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="n">loci_group</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loci</span><span class="p">)):</span>
                    <span class="n">p_locus</span> <span class="o">=</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">c_locus</span> <span class="o">=</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
                    <span class="n">p_locus_strands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]))</span>
                    <span class="n">c_locus_strands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_locus_strands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_locus_strands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">pr_locus_features_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">features</span><span class="p">])</span>
                        <span class="n">c_locus_features_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">features</span><span class="p">])</span>
                        <span class="n">overlapped_f_groups</span> <span class="o">=</span> <span class="n">pr_locus_features_groups</span> <span class="o">&amp;</span> <span class="n">c_locus_features_groups</span>
                        <span class="n">prl_strand</span><span class="p">,</span> <span class="n">cl_strand</span> <span class="o">=</span> <span class="n">p_locus_strands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_locus_strands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">pr_locus_features_strands</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">group</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span> <span class="o">*</span> <span class="n">prl_strand</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span>
                                                     <span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">}</span>
                        <span class="n">c_locus_features_strands</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">group</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span> <span class="o">*</span> <span class="n">cl_strand</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span>
                                                    <span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">}</span>
                        <span class="n">codirection_score</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">ovg</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">:</span>
                            <span class="n">codirection_score</span> <span class="o">+=</span> <span class="n">pr_locus_features_strands</span><span class="p">[</span><span class="n">ovg</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_locus_features_strands</span><span class="p">[</span><span class="n">ovg</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">codirection_score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">count_of_changed_strands</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">annot_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                                <span class="n">cc</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="n">annot_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;strand&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">c_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annot_coordinates</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❗ Warning: loci reorientation cannot be applied for loci that have both strands in&quot;</span>
                              <span class="s2">&quot; pre-defined coordinates for visualisation&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">count_of_changed_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was not changed for any locus&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">count_of_changed_strands</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was changed for 1 locus&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">count_of_changed_strands</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was changed for </span><span class="si">{</span><span class="n">count_of_changed_strands</span><span class="si">}</span><span class="s2"> loci&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define variable feature groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">get_loci_lengths_and_n_of_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get loci lengths and number of regions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list each element of each contains locus size and number of breaks for visualisation track.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loci_sizes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
                <span class="n">number_of_gaps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gaps</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">locus</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> <span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">number_of_gaps</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">loci_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">locus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">number_of_gaps</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">loci_sizes</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to get loci lengths.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a Loci object.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>parameters</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Loci object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        parameters (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;circular&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locus_id&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">,</span> <span class="s2">&quot;stroke_color&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;show_label&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.__load_annotation_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__load_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">,</span> <span class="n">index_column</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Private method to load an annotation file.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>file_path</b>
            (<code>str</code>)
        – <p>File path for an annotation file to be loaded.</p>
      </li>
      <li class="field-body">
        <b>annotation_columns</b>
            (<code>list</code>)
        – <p>List of columns that should be considered.</p>
      </li>
      <li class="field-body">
        <b>index_column</b>
            (<code>str</code>)
        – <p>Column name to be considered as index.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code><span title="pandas.DataFrame">DataFrame</span></code>
        – <p>pd.DataFrame: Preprocessed annotation file.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__load_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">index_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Private method to load an annotation file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_path (str): File path for an annotation file to be loaded.</span>
<span class="sd">        annotation_columns (list): List of columns that should be considered.</span>
<span class="sd">        index_column (str): Column name to be considered as index.</span>

<span class="sd">    Returns:</span>
<span class="sd">          pd.DataFrame: Preprocessed annotation file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">annotation_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">found_allowed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">not_found_allowed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">annotation_columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">annotation_table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">annotation_table</span> <span class="o">=</span> <span class="n">annotation_table</span><span class="p">[</span><span class="n">found_allowed_columns</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_column</span><span class="p">)</span>
    <span class="n">annotation_table</span><span class="p">[</span><span class="n">not_found_allowed_columns</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">annotation_table</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.__update_feature_annotation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__update_feature_annotation</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">locus_id</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Private method for updating feature annotation.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>feature_id</b>
            (<code>str</code>)
        – <p>Feature identifier.</p>
      </li>
      <li class="field-body">
        <b>locus_id</b>
            (<code>str</code>)
        – <p>Sequence description.</p>
      </li>
      <li class="field-body">
        <b>coordinates</b>
            (<code>str</code>)
        – <p>Feature coordinates.</p>
      </li>
      <li class="field-body">
        <b>category</b>
            (<code>str</code>)
        – <p>Feature type.</p>
      </li>
      <li class="field-body">
        <b>name</b>
            (<code>str</code>)
        – <p>Feature name.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__update_feature_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">locus_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Private method for updating feature annotation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        feature_id (str): Feature identifier.</span>
<span class="sd">        locus_id (str): Sequence description.</span>
<span class="sd">        coordinates (str): Feature coordinates.</span>
<span class="sd">        category (str): Feature type.</span>
<span class="sd">        name (str): Feature name.</span>


<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;group_type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="s2">&quot;all&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
        <span class="n">show_label</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show_label</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stroke_color</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;set_feature_stroke_color_based_on_fill_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">stroke_color</span> <span class="o">=</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Methods</span><span class="o">.</span><span class="n">scale_lightness</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">][</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_stroke_color_relative_lightness&quot;</span><span class="p">])</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">locus_id</span><span class="o">=</span><span class="n">locus_id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="n">feature_type</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">group_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
                          <span class="n">stroke_color</span><span class="o">=</span><span class="n">stroke_color</span><span class="p">,</span>
                          <span class="n">show_label</span><span class="o">=</span><span class="n">show_label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">default_values</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.__update_loci_annotation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__update_loci_annotation</span><span class="p">(</span><span class="n">record_id</span><span class="p">,</span> <span class="n">record_description</span><span class="p">,</span> <span class="n">record_length</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Private method for updating loci annotation.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>record_id</b>
            (<code>str</code>)
        – <p>Sequence identifier.</p>
      </li>
      <li class="field-body">
        <b>record_description</b>
            (<code>str</code>)
        – <p>Sequence description.</p>
      </li>
      <li class="field-body">
        <b>record_length</b>
            (<code>int</code>)
        – <p>Sequence length.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__update_loci_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Private method for updating loci annotation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        record_id (str): Sequence identifier.</span>
<span class="sd">        record_description (str): Sequence description.</span>
<span class="sd">        record_length (int): Sequence length.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">record_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

    <span class="n">default_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">record_length</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;1:</span><span class="si">{</span><span class="n">record_length</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                          <span class="n">description</span><span class="o">=</span><span class="n">record_description</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">default_values</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.cluster_sequences" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cluster_sequences</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Define loci order and clusters with proteome similarity based hierarchical clustering.
    This function changes the order of loci that are plotted and also updates corresponding to each loci group
    attribute which defines homologues groups of proteomes.</p>


<p> <b>It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues:</b> <p>groups by other method you can also build pandas dataframe based on that with index corresponding to
feature id and column "cluster" corresponding to the group.</p></p>





  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>dataframe</b>
            (<code><span title="pandas.DataFrame">DataFrame</span></code>)
        – <p>dataframe with feature id - group pairs. Its index column should
represent all loci CDS features.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cluster_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define loci order and clusters with proteome similarity based hierarchical clustering.</span>
<span class="sd">        This function changes the order of loci that are plotted and also updates corresponding to each loci group</span>
<span class="sd">        attribute which defines homologues groups of proteomes.</span>

<span class="sd">    Note: It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues</span>
<span class="sd">        groups by other method you can also build pandas dataframe based on that with index corresponding to</span>
<span class="sd">        feature id and column &quot;cluster&quot; corresponding to the group.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          dataframe (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">            represent all loci CDS features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proteins_loci_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">)</span>
        <span class="n">loci_clusters_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">number_of_loci</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span>
        <span class="n">proteome_sizes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
            <span class="n">locus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
            <span class="n">loci_clusters</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
            <span class="n">loci_clusters_dict</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loci_clusters</span><span class="p">))</span>
            <span class="n">proteome_sizes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loci_clusters</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">l_cl</span> <span class="ow">in</span> <span class="n">loci_clusters</span><span class="p">:</span>
                <span class="n">proteins_loci_dict</span><span class="p">[</span><span class="n">l_cl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locus_index</span><span class="p">)</span>

        <span class="n">loci_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">]</span>
        <span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">loci_clusters_dict</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]:</span>
                <span class="n">js</span> <span class="o">=</span> <span class="n">proteins_loci_dict</span><span class="p">[</span><span class="n">cluster</span><span class="p">]</span>
                <span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">js</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">locus_size</span> <span class="o">=</span> <span class="n">proteome_sizes</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
            <span class="n">norm_factors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">locus_size</span> <span class="o">+</span> <span class="n">proteome_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">locus_size</span> <span class="o">*</span> <span class="n">proteome_sizes</span><span class="p">),</span>
                                     <span class="n">index</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">norm_factors</span><span class="p">)</span>
            <span class="n">similarity_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="n">symmetric_distance_matrix</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">similarity_matrix</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">symmetric_distance_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span>
            <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">squareform</span><span class="p">(</span><span class="n">symmetric_distance_matrix</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
        <span class="n">dendrogram</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">,</span> <span class="n">no_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">),</span>
                             <span class="n">index</span><span class="o">=</span><span class="n">loci_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">dendrogram</span><span class="p">[</span><span class="s2">&quot;leaves&quot;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;initial_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_loci</span><span class="p">):</span>
            <span class="n">locus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">locus_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>

        <span class="n">reordered_similarity_matrix</span> <span class="o">=</span> <span class="n">similarity_matrix</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                                <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;proteome_similarity_matrix.tsv&quot;</span><span class="p">)</span>
        <span class="n">reordered_similarity_matrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">num_of_loci_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">num_of_loci_groups</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🫧 Loci order and </span><span class="si">{</span><span class="n">num_of_loci_groups</span><span class="si">}</span><span class="s2"> cluster was defined with proteome similarity based &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;hierarchical clustering&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">num_of_loci_groups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🫧 Loci order and </span><span class="si">{</span><span class="n">num_of_loci_groups</span><span class="si">}</span><span class="s2"> clusters were defined with proteome similarity based &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;hierarchical clustering&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Proteome similarity matrix of loci was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to cluster loci sequences.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.define_features_groups" class="doc doc-heading">
<code class="highlight language-python"><span class="n">define_features_groups</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set features attribute "group" based on input dataframe.</p>


<p> <b>Note:</b> <p>By default is designed to use mmseqs_cluster() function results as input. If you already have precomputed
feature groups you can set them with feature table.</p></p>





  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>dataframe</b>
            (<code><span title="pandas.DataFrame">DataFrame</span></code>)
        – <p>dataframe with feature id - group pairs. Its index column should
represent all loci CDS features.</p>
      </li>
      <li class="field-body">
        <b>group_column_name</b>
            (<code>str</code>)
        – <p>column name of the dataframe that represent corresponding group to each feature.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">define_features_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cluster&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set features attribute &quot;group&quot; based on input dataframe.</span>

<span class="sd">    Note:</span>
<span class="sd">        By default is designed to use mmseqs_cluster() function results as input. If you already have precomputed</span>
<span class="sd">        feature groups you can set them with feature table.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        dataframe (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">            represent all loci CDS features.</span>
<span class="sd">        group_column_name (str): column name of the dataframe that represent corresponding group to each feature.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_groups&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define protein features groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.define_labels_to_be_shown" class="doc doc-heading">
<code class="highlight language-python"><span class="n">define_labels_to_be_shown</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set feature visaulisation attribute "show_label" based on feature groups.</p>


<p> <b>Note:</b> <p>controlled by feature_labels_to_ignore, feature_group_types_to_show_label, and
feature_group_types_to_show_label_on_first_occurrence parameters.</p></p>





  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">define_labels_to_be_shown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set feature visaulisation attribute &quot;show_label&quot; based on feature groups.</span>

<span class="sd">    Note:</span>
<span class="sd">        controlled by feature_labels_to_ignore, feature_group_types_to_show_label, and</span>
<span class="sd">        feature_group_types_to_show_label_on_first_occurrence parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">added_first_occurrence_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;show_all_feature_labels&quot;</span><span class="p">]:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_labels_to_ignore&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">&quot;any&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
                        <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label&quot;</span><span class="p">]:</span>
                        <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_show_label_on_first_occurrence&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_first_occurrence_labels</span><span class="p">:</span>
                            <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">added_first_occurrence_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable define feature labels to be shown.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.find_variable_feature_groups" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_variable_feature_groups</span><span class="p">(</span><span class="n">mmseqs_results</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Define feature group type attributes (variable or shell/core) based on their conservation in corresponding
    loci group feature.</p>


<p> <b>It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues:</b> <p>groups by other method you can also build pandas dataframe based on that with index corresponding to
feature id and column "cluster" corresponding to the group.</p></p>





  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>mmseqs_results</b>
            (<code><span title="pandas.DataFrame">DataFrame</span></code>)
        – <p>dataframe with feature id - group pairs. Its index column should
represent all loci CDS features.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_variable_feature_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mmseqs_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define feature group type attributes (variable or shell/core) based on their conservation in corresponding</span>
<span class="sd">        loci group feature.</span>

<span class="sd">    Note: It&#39;s designed to use as input mmseqs_cluster() function results. However, if you have obtained homologues</span>
<span class="sd">        groups by other method you can also build pandas dataframe based on that with index corresponding to</span>
<span class="sd">        feature id and column &quot;cluster&quot; corresponding to the group.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          mmseqs_results (pd.DataFrame): dataframe with feature id - group pairs. Its index column should</span>
<span class="sd">            represent all loci CDS features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loci_clusters_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">loci_clusters_cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;CDS_is_variable_cutoff&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">loci_clusters_sizes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">loci_clusters_cutoffs</span><span class="p">[</span><span class="n">loci_clusters_cutoffs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">cluster_types</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">mmseqs_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
            <span class="n">cluster_proteins</span> <span class="o">=</span> <span class="n">mmseqs_results</span><span class="p">[</span><span class="n">mmseqs_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">cluster_loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">if</span>
                            <span class="nb">any</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span> <span class="ow">in</span> <span class="n">cluster_proteins</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">)]</span>
            <span class="n">cluster_loci_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="n">cluster_loci</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">cluster_locus_group</span> <span class="ow">in</span> <span class="n">cluster_loci_groups</span><span class="p">:</span>
                <span class="n">current_group_cluster_loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="n">cluster_loci</span> <span class="k">if</span>
                                              <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="n">cluster_locus_group</span><span class="p">]</span>
                <span class="n">current_group_cluster_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_group_cluster_loci</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">loci_clusters_sizes</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> \
                        <span class="n">current_group_cluster_size</span> <span class="o">&lt;=</span> <span class="n">loci_clusters_cutoffs</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">]:</span>
                    <span class="n">cluster_types</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">][</span><span class="n">cluster</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;variable&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster_types</span><span class="p">[</span><span class="n">cluster_locus_group</span><span class="p">][</span><span class="n">cluster</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;shell/core&quot;</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="n">locus_group</span> <span class="o">=</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_groups&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="o">=</span> <span class="n">cluster_types</span><span class="p">[</span><span class="n">locus_group</span><span class="p">][</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define variable feature groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.get_loci_lengths_and_n_of_regions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_loci_lengths_and_n_of_regions</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get loci lengths and number of regions.</p>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
<b>list</b>(            <code>list[list[int]]</code>
)        – <p>list each element of each contains locus size and number of breaks for visualisation track.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_loci_lengths_and_n_of_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get loci lengths and number of regions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: list each element of each contains locus size and number of breaks for visualisation track.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loci_sizes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="n">number_of_gaps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gaps</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">locus</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> <span class="n">locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">number_of_gaps</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">loci_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">locus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">number_of_gaps</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">loci_sizes</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to get loci lengths.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.load_features_annotation_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_features_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load features annotation file.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>file_path</b>
            (<code>str</code>)
        – <p>File path for a features annotation file to be loaded.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_features_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load features annotation file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_path (str): File path for a features annotation file to be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">annotation_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feature_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locus_id&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;group_type&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">,</span> <span class="s2">&quot;stroke_color&quot;</span><span class="p">,</span> <span class="s2">&quot;show_label&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">,</span> <span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.load_loci_annotation_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_loci_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load loci annotation file.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>file_path</b>
            (<code>str</code>)
        – <p>File path for a loci annotation file to be loaded.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_loci_annotation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load loci annotation file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_path (str): File path for a loci annotation file to be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">annotation_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;circular&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_annotation_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">annotation_columns</span><span class="p">,</span> <span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.load_loci_from_extended_gff" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_loci_from_extended_gff</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load loci from the folder with gff files. Each GFF file also should contain corresponding nucleotide
    sequence. Such files are produced for example by pharokka annotation tool.</p>


<p> <b>Note:</b> <p>All files with extension other than .gff (not case-sensitive) will be ignored.</p></p>





  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>input_folder</b>
            (<code>str</code>)
        – <p>folder name with gff files.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_loci_from_extended_gff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load loci from the folder with gff files. Each GFF file also should contain corresponding nucleotide</span>
<span class="sd">        sequence. Such files are produced for example by pharokka annotation tool.</span>

<span class="sd">    Note:</span>
<span class="sd">        All files with extension other than .gff (not case-sensitive) will be ignored.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        input_folder: folder name with gff files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_folder</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gff_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.gff&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gff_files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not contain .gff(.GFF) files.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gff_file</span> <span class="ow">in</span> <span class="n">gff_files</span><span class="p">:</span>
            <span class="n">gff_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">gff_file</span><span class="p">)</span>
            <span class="n">gff_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BCBio</span><span class="o">.</span><span class="n">GFF</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">gff_file_path</span><span class="p">,</span> <span class="n">limit_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">gff_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDS&quot;</span><span class="p">])))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gff_records</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gff file </span><span class="si">{</span><span class="n">gff_file</span><span class="si">}</span><span class="s2"> does not contain information for only&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; 1 sequence.&quot;</span><span class="p">)</span>
            <span class="n">gff_record</span> <span class="o">=</span> <span class="n">gff_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">record_locus_sequence</span> <span class="o">=</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">seq</span>
            <span class="k">except</span> <span class="n">Bio</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">UndefinedSequenceError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gff file doesn&#39;t contain corresponding sequences.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_description_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">:</span>
                <span class="n">record_description</span> <span class="o">=</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_description_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record_description</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record_description</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__update_loci_annotation</span><span class="p">(</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record_description</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">))</span>
            <span class="n">locus_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;strand&quot;</span><span class="p">],</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>
                           <span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="n">record_locus</span> <span class="o">=</span> <span class="n">Locus</span><span class="p">(</span><span class="n">seq_id</span><span class="o">=</span><span class="n">gff_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                 <span class="n">description</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                                 <span class="n">circular</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;circular&quot;</span><span class="p">],</span>
                                 <span class="n">length</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[],</span>
                                 <span class="n">order</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
            <span class="n">features_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gff file </span><span class="si">{</span><span class="n">gff_file</span><span class="si">}</span><span class="s2"> contains duplicated feature ids while&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; only unique are allowed.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gff_feature</span> <span class="ow">in</span> <span class="n">gff_record</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="n">feature_id</span> <span class="o">=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">id</span>
                <span class="n">transl_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;default_transl_table&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;transl_table&quot;</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">transl_table</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;transl_table&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_name_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_name_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_function_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;gff_CDS_function_source&quot;</span><span class="p">]])</span>
                <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__update_feature_annotation</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                         <span class="s2">&quot;CDS&quot;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                        <span class="n">feature_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
                        <span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">feature_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">],</span>
                                          <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                          <span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span>
                                          <span class="n">name</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                          <span class="n">sequence</span><span class="o">=</span><span class="n">gff_feature</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">transl_table</span><span class="p">,</span>
                                                                         <span class="n">cds</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                          <span class="n">group</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">],</span>
                                          <span class="n">group_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group_type&quot;</span><span class="p">],</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                                          <span class="n">vis_prms</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                        <span class="n">stroke_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;stroke_color&quot;</span><span class="p">],</span>
                                                        <span class="n">show_label</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]),</span>
                                          <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">)</span>
                        <span class="n">record_locus</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_locus</span><span class="p">)</span>
        <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> locus was loaded from extended gff files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> loci were loaded from extended gff files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to load loci from gff folder.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.load_loci_from_gb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_loci_from_gb</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load loci from the folder with genbank files.</p>


<p> <b>Note:</b> <p>All files with extension other than .gb (not case-sensitive) will be ignored.</p></p>





  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>input_folder</b>
            (<code>str</code>)
        – <p>folder name with gb files.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_loci_from_gb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load loci from the folder with genbank files.</span>

<span class="sd">    Note:</span>
<span class="sd">        All files with extension other than .gb (not case-sensitive) will be ignored.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        input_folder: folder name with gb files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_folder</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gb_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.gb&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gb_files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">input_folder</span><span class="si">}</span><span class="s2"> does not contain .gb(.GB) files.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gb_file</span> <span class="ow">in</span> <span class="n">gb_files</span><span class="p">:</span>
            <span class="n">gb_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">gb_file</span><span class="p">)</span>
            <span class="n">gb_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Bio</span><span class="o">.</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">gb_file_path</span><span class="p">,</span> <span class="s2">&quot;genbank&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gb_records</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gb file </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2"> does not contain information for only&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; 1 sequence.&quot;</span><span class="p">)</span>
            <span class="n">gb_record</span> <span class="o">=</span> <span class="n">gb_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">record_locus_sequence</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">seq</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
                <span class="n">record_description</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">description</span>
            <span class="k">elif</span> <span class="s2">&quot;annotations:&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]:</span>
                <span class="n">feature_description_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_description_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">record_description</span> <span class="o">=</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="n">feature_description_key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">record_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_loci_annotation</span><span class="p">(</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record_description</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">))</span>
            <span class="n">locus_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;strand&quot;</span><span class="p">],</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>
                           <span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="n">record_locus</span> <span class="o">=</span> <span class="n">Locus</span><span class="p">(</span><span class="n">seq_id</span><span class="o">=</span><span class="n">gb_record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                 <span class="n">description</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                                 <span class="n">circular</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;circular&quot;</span><span class="p">],</span>
                                 <span class="n">length</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[],</span>
                                 <span class="n">order</span><span class="o">=</span><span class="n">locus_annotation_row</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>

            <span class="n">gb_CDSs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gb_record</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;CDS&quot;</span><span class="p">]</span>
            <span class="n">first_CDS_record</span> <span class="o">=</span> <span class="n">gb_CDSs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">id_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_CDS_record</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">alternative_id_source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_alternative_source&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">alternative_id_source</span> <span class="ow">in</span> <span class="n">first_CDS_record</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                        <span class="n">id_source</span> <span class="o">=</span> <span class="n">alternative_id_source</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❗ Warning: there is no &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt; attribute &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;for CDS records in </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2">. Alternative &lt;</span><span class="si">{</span><span class="n">id_source</span><span class="si">}</span><span class="s2">&gt; was used instead.&quot;</span><span class="p">,</span>
                              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">id_source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_id_source&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt; &quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot;attribute for CDS record found in </span><span class="si">{</span><span class="n">gb_file</span><span class="si">}</span><span class="s2">. We tried to&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot; find any from the alternative list: &quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;genbank_id_alternative_source&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
                                                       <span class="sa">f</span><span class="s2">&quot;, but they also weren&#39;t found.&quot;</span><span class="p">)</span>  <span class="c1"># add about cmd parameter</span>
            <span class="n">features_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">id_source</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gb_CDSs</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features_ids</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GB file </span><span class="si">{</span><span class="n">gb_record</span><span class="si">}</span><span class="s2"> contains duplicated feature ids while&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; only unique are allowed.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gb_feature</span> <span class="ow">in</span> <span class="n">gb_CDSs</span><span class="p">:</span>
                <span class="n">feature_id</span> <span class="o">=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">id_source</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">transl_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;default_transl_table&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;transl_table&quot;</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">transl_table</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;transl_table&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_name_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_name_source&quot;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_function_source&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;genbank_CDS_function_source&quot;</span><span class="p">]])</span>
                <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__update_feature_annotation</span><span class="p">(</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">record_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;CDS&quot;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                        <span class="n">feature_annotation_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_id</span><span class="p">]</span>
                        <span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">feature_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">],</span>
                                          <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                          <span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">),</span>
                                          <span class="n">strand</span><span class="o">=</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                          <span class="n">sequence</span><span class="o">=</span><span class="n">gb_feature</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">record_locus_sequence</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">transl_table</span><span class="p">,</span>
                                                                        <span class="n">cds</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                          <span class="n">group</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">],</span>
                                          <span class="n">group_type</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;group_type&quot;</span><span class="p">],</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                                          <span class="n">vis_prms</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                                                        <span class="n">stroke_color</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;stroke_color&quot;</span><span class="p">],</span>
                                                        <span class="n">show_label</span><span class="o">=</span><span class="n">feature_annotation_row</span><span class="p">[</span><span class="s2">&quot;show_label&quot;</span><span class="p">]),</span>
                                          <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="p">)</span>

                        <span class="n">record_locus</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_locus</span><span class="p">)</span>
        <span class="n">seq_id_to_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">locus</span><span class="p">:</span> <span class="n">seq_id_to_order</span><span class="p">[</span><span class="n">locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> locus was loaded from genbank files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">)</span><span class="si">}</span><span class="s2"> loci were loaded from genbank files folder&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to load loci from gb folder.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.mmseqs_cluster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mmseqs_cluster</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Cluster all proteins using mmseqs in order to define groups of homologues.</p>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code><span title="pandas.DataFrame">DataFrame</span></code>
        – <p>pd.DataFrame: parsed mmseqs table (pandas dataframe) with columns: cluster, protein_id; where cluster is
defined by representative sequence id within a corresponding cluster.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mmseqs_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cluster all proteins using mmseqs in order to define groups of homologues.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: parsed mmseqs table (pandas dataframe) with columns: cluster, protein_id; where cluster is</span>
<span class="sd">            defined by representative sequence id within a corresponding cluster.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Running mmseqs for protein clustering...&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">feature_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">record</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
        <span class="n">temp_input</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
        <span class="n">Bio</span><span class="o">.</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">feature_records</span><span class="p">,</span> <span class="n">temp_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
        <span class="n">mmseqs_output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;mmseqs&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">)</span>
        <span class="n">mmseqs_output_folder_db</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;DB&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">)</span>
        <span class="n">mmseqs_stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_stdout.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">mmseqs_stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_stderr.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;createdb&quot;</span><span class="p">,</span> <span class="n">temp_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">)],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span>
                       <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;clusterDB&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;--cluster-mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_cluster_mode&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;--cov-mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_cov_mode&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;--min-seq-id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_min_seq_id&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_c&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_s&quot;</span><span class="p">])],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;mmseqs_binary&quot;</span><span class="p">],</span> <span class="s2">&quot;createtsv&quot;</span><span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;sequencesDB&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder_db</span><span class="p">,</span> <span class="s2">&quot;clusterDB&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_clustering.tsv&quot;</span><span class="p">)],</span>
                       <span class="n">stdout</span><span class="o">=</span><span class="n">mmseqs_stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">mmseqs_stderr</span><span class="p">)</span>
        <span class="n">mmseqs_clustering_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span> <span class="s2">&quot;mmseqs_clustering.tsv&quot;</span><span class="p">),</span>
                                                  <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;protein_id&quot;</span><span class="p">])</span>
        <span class="n">mmseqs_clustering_results</span> <span class="o">=</span> <span class="n">mmseqs_clustering_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;protein_id&quot;</span><span class="p">)</span>

        <span class="n">num_of_unique_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mmseqs_clustering_results</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
        <span class="n">num_of_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mmseqs_clustering_results</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">num_of_unique_clusters</span><span class="si">}</span><span class="s2"> clusters for </span><span class="si">{</span><span class="n">num_of_proteins</span><span class="si">}</span><span class="s2"> proteins were found with mmseqs</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;💌 mmseqs clustering results were saved to &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mmseqs_output_folder</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mmseqs_clustering.tsv&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mmseqs_clustering_results</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to run mmseqs clustering.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.reorient_loci" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reorient_loci</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Auto re-orient loci (reset strands) of loci if they are not matched.</p>


<p> <b>Note:</b> <p>Function tries to maximise co-orientation of homologous features.</p></p>





  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reorient_loci</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Auto re-orient loci (reset strands) of loci if they are not matched.</span>

<span class="sd">    Note:</span>
<span class="sd">        Function tries to maximise co-orientation of homologous features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loci_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
        <span class="n">count_of_changed_strands</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">loci_group</span> <span class="ow">in</span> <span class="n">loci_groups</span><span class="p">:</span>
            <span class="n">loci</span> <span class="o">=</span> <span class="p">[</span><span class="n">locus</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">if</span> <span class="n">locus</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="n">loci_group</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">locus_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loci</span><span class="p">)):</span>
                <span class="n">p_locus</span> <span class="o">=</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">c_locus</span> <span class="o">=</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span>
                <span class="n">p_locus_strands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]))</span>
                <span class="n">c_locus_strands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_locus_strands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_locus_strands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pr_locus_features_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">features</span><span class="p">])</span>
                    <span class="n">c_locus_features_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">features</span><span class="p">])</span>
                    <span class="n">overlapped_f_groups</span> <span class="o">=</span> <span class="n">pr_locus_features_groups</span> <span class="o">&amp;</span> <span class="n">c_locus_features_groups</span>
                    <span class="n">prl_strand</span><span class="p">,</span> <span class="n">cl_strand</span> <span class="o">=</span> <span class="n">p_locus_strands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_locus_strands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">pr_locus_features_strands</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">group</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span> <span class="o">*</span> <span class="n">prl_strand</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p_locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span>
                                                 <span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">}</span>
                    <span class="n">c_locus_features_strands</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">group</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span> <span class="o">*</span> <span class="n">cl_strand</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">c_locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span>
                                                <span class="n">f</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">}</span>
                    <span class="n">codirection_score</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">ovg</span> <span class="ow">in</span> <span class="n">overlapped_f_groups</span><span class="p">:</span>
                        <span class="n">codirection_score</span> <span class="o">+=</span> <span class="n">pr_locus_features_strands</span><span class="p">[</span><span class="n">ovg</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_locus_features_strands</span><span class="p">[</span><span class="n">ovg</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">codirection_score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">count_of_changed_strands</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">annot_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">loci</span><span class="p">[</span><span class="n">locus_index</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                            <span class="n">cc</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">annot_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cc</span><span class="p">[</span><span class="s1">&#39;strand&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">c_locus</span><span class="o">.</span><span class="n">seq_id</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annot_coordinates</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❗ Warning: loci reorientation cannot be applied for loci that have both strands in&quot;</span>
                          <span class="s2">&quot; pre-defined coordinates for visualisation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">count_of_changed_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was not changed for any locus&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">count_of_changed_strands</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was changed for 1 locus&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">count_of_changed_strands</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔁 Orientation was changed for </span><span class="si">{</span><span class="n">count_of_changed_strands</span><span class="si">}</span><span class="s2"> loci&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to define variable feature groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.save_features_annotation_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_features_annotation_table</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save feature annotation table to the output folder.</p>


<p> <b>Note:</b> <p>Output file name is features_annotation_table.tsv</p></p>





  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_features_annotation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save feature annotation table to the output folder.</span>

<span class="sd">    Note:</span>
<span class="sd">        Output file name is features_annotation_table.tsv</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;features_annotation_table.tsv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">&quot;feature_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Feature annotation table was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to save feature annotation table.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.save_loci_annotation_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_loci_annotation_table</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save loci annotation table to the output folder.</p>


<p> <b>Note:</b> <p>Output file name is loci_annotation_table.tsv</p></p>





  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_loci_annotation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save loci annotation table to the output folder.</span>

<span class="sd">    Note:</span>
<span class="sd">        Output file name is loci_annotation_table.tsv</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;loci_annotation_table.tsv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loci_annotation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">&quot;sequence_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💌 Loci annotation table was saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to save loci annotation table.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.set_category_colors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_category_colors</span><span class="p">(</span><span class="n">use_table</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Define colors for each category.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>use_table</b>
            (<code>bool</code>)
        – <p>Bool value whether table with predefined colors should be used or not.</p>
      </li>
  </ul>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_category_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_table</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define colors for each category.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        use_table (bool): Bool value whether table with predefined colors should be used or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">colors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">use_table</span><span class="p">:</span>
            <span class="n">colors_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_colors&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="n">feature_categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">category</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span>
                                       <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">category</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_categories</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❗ Warning: there are no feature categories to set colors&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">colors_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">cat</span><span class="p">:</span> <span class="n">col</span> <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">feature_categories</span><span class="p">}</span>

        <span class="n">feature_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">feature_categories</span> <span class="k">if</span> <span class="n">ff</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colors_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">number_of_unique_feature_functions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_categories</span><span class="p">)</span>
        <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_color_seaborn_palette&quot;</span><span class="p">],</span>
                                           <span class="n">number_of_unique_feature_functions</span><span class="p">,</span>
                                           <span class="n">desat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;category_color_seaborn_desat&quot;</span><span class="p">])</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">colors_rgb</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">colors_rgb</span><span class="p">))</span>
        <span class="n">colors_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_categories</span><span class="p">),</span> <span class="n">colors</span><span class="p">)})</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="n">locus</span><span class="o">.</span><span class="n">category_colors</span> <span class="o">=</span> <span class="n">colors_dict</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to set category colors.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Loci.set_feature_colors_based_on_groups" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_feature_colors_based_on_groups</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Define features fill color based on corresponding feature group and group types.</p>

  <p> <b>Returns:</b></p>
  <ul>
      <li class="field-body">
            <code>None</code>
        – <p>None</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_feature_colors_based_on_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define features fill color based on corresponding feature group and group types.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">feature_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="s2">&quot;all&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]:</span>
            <span class="n">feature_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span>
                                  <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">group_type</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;feature_group_types_to_set_color&quot;</span><span class="p">]])</span>
        <span class="n">number_of_unique_feature_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_groups</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_palette_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;seaborn&quot;</span><span class="p">:</span>
            <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_seaborn_palette&quot;</span><span class="p">],</span>
                                               <span class="n">number_of_unique_feature_groups</span><span class="p">,</span>
                                               <span class="n">desat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_seaborn_desat&quot;</span><span class="p">])</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">colors_rgb</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_color_palette_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;distinctipy&quot;</span><span class="p">:</span>
            <span class="n">colors_rgb</span> <span class="o">=</span> <span class="n">distinctipy</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">number_of_unique_feature_groups</span><span class="p">,</span>
                                                <span class="n">exclude_colors</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                                                <span class="n">pastel_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;groups_fill_colors_pastel_factor&quot;</span><span class="p">])</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">colors_rgb</span><span class="p">))</span>
        <span class="n">colors_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_groups</span><span class="p">),</span> <span class="n">colors</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">locus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">locus</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">group</span> <span class="ow">in</span> <span class="n">feature_groups</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prms</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;keep_predefined_colors&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors_dict</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">group</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature_annotation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_id</span><span class="p">,</span> <span class="s2">&quot;fill_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">vis_prms</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="s2">&quot;Unable to set feature colors based on groups.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="lovis4u.DataProcessing.Locus" class="doc doc-heading">
        <code>Locus</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A Locus object represents a particular locus that will be one of the sequence tracks on final figure.</p>

  <p><b>Attributes:</b></p>
  <ul>
      <li class="field-body">
        <b>seq_id</b>
            (<code>str</code>)
        – <p>Sequence identifier. Can be used to label locus.</p>
      </li>
      <li class="field-body">
        <b>coordinates</b>
            (<code>list</code>)
        – <p>List of regions to be shown. Each region format: dict with keys: start, end, strand and
corresponding 1-based start, end coordinates and strand (1: plus strand, -1: minus strand).</p>
      </li>
      <li class="field-body">
        <b>size</b>
            (<code>int</code>)
        – <p>total length of regions to be plotted.</p>
      </li>
      <li class="field-body">
        <b>description</b>
            (<code>str</code>)
        – <p>Sequence description that can be used to label locus.</p>
      </li>
      <li class="field-body">
        <b>length</b>
            (<code>int</code>)
        – <p>full length of the locus independent on region that should be plotted.</p>
      </li>
      <li class="field-body">
        <b>circular</b>
            (<code>bool</code>)
        – <p>Bool value whether locus is circular or not. It defines whether you have gap or not passing
1 value on the final figure.</p>
      </li>
      <li class="field-body">
        <b>features</b>
            (<code>list</code>)
        – <p>list of Feature objects that overlapped with coordinates.</p>
      </li>
      <li class="field-body">
        <b>order</b>
            (<code>int</code>)
        – <p>index on ordered list of loci visualisation. Can be pre-defined or found based on loci
hierarchical clustering with cluster_sequences category.</p>
      </li>
      <li class="field-body">
        <b>group</b>
            (<code>int | str</code>)
        – <p>locus group that defines set of closely-related loci.</p>
      </li>
      <li class="field-body">
        <b>category_colors</b>
            (<code>dict</code>)
        – <p>colors for locus' features categories.</p>
      </li>
      <li class="field-body">
        <b>prms</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
  </ul>


        <details class="quote">
          <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Locus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Locus object represents a particular locus that will be one of the sequence tracks on final figure.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        seq_id (str): Sequence identifier. Can be used to label locus.</span>
<span class="sd">        coordinates (list): List of regions to be shown. Each region format: dict with keys: start, end, strand and</span>
<span class="sd">            corresponding 1-based start, end coordinates and strand (1: plus strand, -1: minus strand).</span>
<span class="sd">        size (int): total length of regions to be plotted.</span>
<span class="sd">        description (str): Sequence description that can be used to label locus.</span>
<span class="sd">        length (int): full length of the locus independent on region that should be plotted.</span>
<span class="sd">        circular (bool): Bool value whether locus is circular or not. It defines whether you have gap or not passing</span>
<span class="sd">            1 value on the final figure.</span>
<span class="sd">        features (list): list of Feature objects that overlapped with coordinates.</span>
<span class="sd">        order (int): index on ordered list of loci visualisation. Can be pre-defined or found based on loci</span>
<span class="sd">            hierarchical clustering with cluster_sequences category.</span>
<span class="sd">        group (int | str): locus group that defines set of closely-related loci.</span>
<span class="sd">        category_colors (dict): colors for locus&#39; features categories.</span>
<span class="sd">        prms (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">circular</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                 <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Locus object.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            seq_id (str): Sequence identifier. Can be used to label locus.</span>
<span class="sd">            coordinates (list): List of regions to be shown. Each region format: dict with keys: start, end, strand and</span>
<span class="sd">                corresponding 1-based start, end coordinates and strand (1: plus strand, -1: minus strand).</span>
<span class="sd">            description (str): Sequence description that can be used to label locus.</span>
<span class="sd">            length (int): full length of the locus independent on region that should be plotted.</span>
<span class="sd">            circular (bool): Bool value whether locus is circular or not. It defines whether you have gap or not passing</span>
<span class="sd">                1 value on the final figure.</span>
<span class="sd">            features (list): list of Feature objects that overlapped with coordinates.</span>
<span class="sd">            order (int): index on ordered list of loci visualisation. Can be pre-defined or found based on loci</span>
<span class="sd">            hierarchical clustering with cluster_sequences category.</span>
<span class="sd">            parameters (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>
<span class="sd">            group (int | str): locus group that defines set of closely-related loci [1].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq_id</span> <span class="o">=</span> <span class="n">seq_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">taken_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">taken_coordinates</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taken_coordinates</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">taken_coordinates</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specified coordinates seems to be overlapped&quot;</span>
                                               <span class="sa">f</span><span class="s2">&quot; or not in 0-based format.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordinates for </span><span class="si">{</span><span class="n">seq_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">coordinate</span><span class="si">}</span><span class="s2"> is in 0-based format&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; while input should be in 1-based.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordinates for </span><span class="si">{</span><span class="n">seq_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">coordinate</span><span class="si">}</span><span class="s2"> is out of sequence length&quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2"> nt).&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="o">=</span> <span class="n">circular</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="lovis4u.DataProcessing.Locus.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">seq_id</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">circular</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a Locus object.</p>

  <p><b>Parameters:</b></p>
  <ul>
      <li class="field-body">
        <b>seq_id</b>
            (<code>str</code>)
        – <p>Sequence identifier. Can be used to label locus.</p>
      </li>
      <li class="field-body">
        <b>coordinates</b>
            (<code>list</code>)
        – <p>List of regions to be shown. Each region format: dict with keys: start, end, strand and
corresponding 1-based start, end coordinates and strand (1: plus strand, -1: minus strand).</p>
      </li>
      <li class="field-body">
        <b>description</b>
            (<code>str</code>)
        – <p>Sequence description that can be used to label locus.</p>
      </li>
      <li class="field-body">
        <b>length</b>
            (<code>int</code>)
        – <p>full length of the locus independent on region that should be plotted.</p>
      </li>
      <li class="field-body">
        <b>circular</b>
            (<code>bool</code>)
        – <p>Bool value whether locus is circular or not. It defines whether you have gap or not passing
1 value on the final figure.</p>
      </li>
      <li class="field-body">
        <b>features</b>
            (<code>list</code>)
        – <p>list of Feature objects that overlapped with coordinates.</p>
      </li>
      <li class="field-body">
        <b>order</b>
            (<code>int</code>)
        – <p>index on ordered list of loci visualisation. Can be pre-defined or found based on loci</p>
      </li>
      <li class="field-body">
        <b>parameters</b>
            (<code><a class="autorefs autorefs-internal" title="lovis4u.Manager.Parameters" href="../package_manager/#lovis4u.Manager.Parameters">Parameters</a></code>)
        – <p>Parameters' class object that holds config and cmd arguments.</p>
      </li>
      <li class="field-body">
        <b>group</b>
            (<code>int | str</code>)
        – <p>locus group that defines set of closely-related loci [1].</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>lovis4u/DataProcessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">circular</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
             <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">Parameters</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Locus object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        seq_id (str): Sequence identifier. Can be used to label locus.</span>
<span class="sd">        coordinates (list): List of regions to be shown. Each region format: dict with keys: start, end, strand and</span>
<span class="sd">            corresponding 1-based start, end coordinates and strand (1: plus strand, -1: minus strand).</span>
<span class="sd">        description (str): Sequence description that can be used to label locus.</span>
<span class="sd">        length (int): full length of the locus independent on region that should be plotted.</span>
<span class="sd">        circular (bool): Bool value whether locus is circular or not. It defines whether you have gap or not passing</span>
<span class="sd">            1 value on the final figure.</span>
<span class="sd">        features (list): list of Feature objects that overlapped with coordinates.</span>
<span class="sd">        order (int): index on ordered list of loci visualisation. Can be pre-defined or found based on loci</span>
<span class="sd">        hierarchical clustering with cluster_sequences category.</span>
<span class="sd">        parameters (lovis4u.Manager.Parameters): Parameters&#39; class object that holds config and cmd arguments.</span>
<span class="sd">        group (int | str): locus group that defines set of closely-related loci [1].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq_id</span> <span class="o">=</span> <span class="n">seq_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">taken_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">taken_coordinates</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taken_coordinates</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">taken_coordinates</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specified coordinates seems to be overlapped&quot;</span>
                                           <span class="sa">f</span><span class="s2">&quot; or not in 0-based format.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordinates for </span><span class="si">{</span><span class="n">seq_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">coordinate</span><span class="si">}</span><span class="s2"> is in 0-based format&quot;</span>
                                               <span class="sa">f</span><span class="s2">&quot; while input should be in 1-based.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinate</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">lovis4u</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">lovis4uError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordinates for </span><span class="si">{</span><span class="n">seq_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">coordinate</span><span class="si">}</span><span class="s2"> is out of sequence length&quot;</span>
                                               <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2"> nt).&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="o">=</span> <span class="n">circular</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category_colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prms</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../usage_examples/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Usage examples" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Usage examples
            </div>
          </div>
        </a>
      
      
        
        <a href="../package_manager/" class="md-footer__link md-footer__link--next" aria-label="Next: lovis4u.Manager" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              lovis4u.Manager
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "announce.dismiss", "navigation.tabs", "toc.integrate", "header.autohide"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c99f48ec.min.js"></script>
      
        <script src="../../assets/_markdown_exec_pyodide.js"></script>
      
    
  </body>
</html>